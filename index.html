<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>TAO‑R³ • Temporal–Agentic–Ontological Relativity</title>
<style>
  :root {
    --bg: #0e111a; --panel: #141825; --ink: #e9ecf6; --muted: #9aa7c7;
    --accent: #6cc6ff; --accent2: #6ee7a2; --warn: #ffb86b; --danger: #ff7b7b; --outline: rgba(255,255,255,.12);
    --header-h: 60px;
  }
  [data-theme="light"] { --bg:#f6f8ff; --panel:#fff; --ink:#111629; --muted:#4a5877; --outline:rgba(0,0,0,.1); }
  * { box-sizing: border-box; }
  html { height: 100%; overflow: hidden; }
  body { margin:0; color:var(--ink); background:var(--bg); font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; height: 100%; overflow: hidden; }
  header { position:fixed; top:0; left:0; display: flex; align-items: center;z-index:2; background:linear-gradient(180deg, rgba(255,255,255,.06), transparent), var(--panel); border-bottom:1px solid var(--outline); padding:12px 16px; }
  .row { display:flex; align-items:center; gap:12px; flex-wrap:wrap; }
  h1 { margin:0; font-size:18px; letter-spacing:.3px; }
  .muted{ color:var(--muted); font-size:13px; }
  main { display:grid; grid-template-columns:420px 1fr; gap:16px; padding:16px; margin-top: calc(var(--header-h) + 32px); height: calc(100vh - var(--header-h) - 32px); }
  @media (max-width: 980px) { main { grid-template-columns: 1fr; } }
  .card { background:var(--panel); border:1px solid var(--outline); border-radius:12px; padding:14px; box-shadow:0 8px 24px rgba(0,0,0,.12); }
  main > .card { min-height: 0; }
  .card.scroll{ overflow: auto; scroll-behavior: smooth; }
  .card.chart-card{ /* no overflow; just fills available height */ }
  canvas{ width: 100%; height: 100%; background: #0a0d18; border-radius: 12px; display: block; }
  .title { font-weight:800; margin:0 0 10px; }
  fieldset { border:none; margin:0 0 10px; padding:0; }
  legend { font-weight:700; margin-bottom:6px; }
  .item { margin:8px 0 10px; padding:0 0 8px; border-bottom:1px dashed var(--outline); }
  .item:last-child{ border-bottom:0; }
  .qtext{ margin:0 0 6px; }
  .scale{ display:grid; grid-template-columns:repeat(7,1fr); gap:6px; }
  input[type="radio"]{ position:absolute; opacity:0; pointer-events:none; left:-9999px; }
  input[type="radio"]:focus{ outline:none; }
  .scale label{ display:inline-block; text-align:center; padding:8px 0; border:1px solid var(--outline); border-radius:8px; cursor:pointer; color:var(--muted); }
  input[type="radio"]:checked + label{ color:var(--ink); border-color:var(--accent); background:linear-gradient(180deg, rgba(108,198,255,.12), transparent); font-weight:700; }
  .actions { display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin-top:10px; }
  button { appearance:none; border:1px solid var(--outline); background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(0,0,0,.02)); color:var(--ink); padding:10px 14px; border-radius:10px; cursor:pointer; font-weight:700; }
  .results { display:grid; grid-template-columns:repeat(3,1fr); gap:10px; margin-top:10px; }
  .pill{ background:transparent; border:1px solid var(--outline); border-radius:10px; padding:10px; text-align:center; }
  .big{ font-size:28px; font-weight:900; }
  .mini{ font-size:12px; color:var(--muted); margin-top:2px; }
  .legend { display:grid; grid-template-columns:repeat(2, minmax(0,1fr)); gap:6px; margin-top:8px; color:var(--muted); font-size:12px; }
  canvas{ width:100%; height:520px; background:#0a0d18; border-radius:12px; display:block; }
  [data-theme="light"] canvas{ background:#f2f6ff; }
  .typeBox{ margin-top:10px; padding:10px; border:1px solid var(--outline); border-radius:10px; }
  .sidebar { font-size: 12px; color: var(--muted); margin-top: 8px; }
  .dot { display:inline-block; width:10px; height:10px; border-radius:50%; margin-right:6px; vertical-align:middle; }
  .tooltip { position: fixed; pointer-events:none; background: rgba(0,0,0,.8); color:#fff; padding:6px 8px; border-radius:6px; font-size:12px; transform: translate(-50%, calc(-100% - 10px)); white-space:nowrap; z-index: 10; display: none; }
  .legend-row { cursor: pointer; transition: opacity 0.2s ease; }
  .legend-row:hover { background: var(--outline); }
  .legend-row.hidden { opacity: 0.4; }
  .legend-row.hidden .dot { opacity: 0.3; }
</style>
<script type="importmap">
{
  "imports": {
    "three": "https://unpkg.com/three@0.159.0/build/three.module.js",
    "three/addons/": "https://unpkg.com/three@0.159.0/examples/jsm/"
  }
}
</script>
</head>
<body>
<header>
  <div class="row">
    <h1>TAO‑R³</h1>
    <span class="muted">Questionnaire + your point + reference traditions plotted</span>
    <button id="themeBtn">Toggle Theme</button>
    <label class="muted" style="margin-left:12px;">
      Color by:
      <select id="colorMode">
        <option value="category">Category</option>
        <option value="time">Time</option>
        <option value="T">T axis</option>
        <option value="A">A axis</option>
        <option value="O">O axis</option>
      </select>
    </label>

    <label class="muted" style="margin-left:12px;">
      Data Source
      <select id="dataSource">
        <option value="both">Both</option>
        <option value="traditions">Traditions</option>
        <option value="figures">Figures</option>
      </select>
    </label>

    <span class="muted" style="margin-left:12px;">Year:</span>
    <input id="yearRange" type="range" min="-3000" max="2025" value="2025" step="10" style="width:220px; vertical-align:middle;">
    <span id="yearLabel" class="muted" style="min-width:62px; display:inline-block;">≤ 2025</span>
    <br>
    <label class="muted" style="margin-left:12px;">
      Trend ribbons
      <input id="trendToggle" type="checkbox" style="vertical-align:middle;">
    </label>

    <label class="muted" style="margin-left:8px;">
      Trend axis
      <select id="trendAxis">
        <option value="T">T</option>
        <option value="A">A</option>
        <option value="O">O</option>
      </select>
    </label>

    <label class="muted" style="margin-left:8px;">
      Tradition
      <select id="traditionFilter">
        <option value="__all__">All</option>
      </select>
    </label>

    <label class="muted" style="margin-left:8px;">
      Subtype
      <select id="subtypeFilter" disabled>
        <option value="__all__">All</option>
      </select>
    </label>
  </div>
</header>

<main>
  <section class="card scroll">
    <h2 class="title">Your Responses</h2>
    <form id="taoForm">
      <fieldset class="t-fields">
        <legend>Temporal Orientation (T)</legend>
        <p class="muted">1 = Strongly disagree… 7 = Strongly agree</p>

        <div class="item"><p class="qtext">T1. Over the long run, history tends toward improvement.</p><div class="scale" data-key="T1"></div></div>
        <div class="item"><p class="qtext">T2. Historical patterns primarily recur in cycles rather than moving toward an endpoint.</p><div class="scale" data-key="T2" data-reverse="true"></div></div>
        <div class="item"><p class="qtext">T3. Lasting change is chiefly cumulative progress rather than repetition.</p><div class="scale" data-key="T3"></div></div>
        <div class="item"><p class="qtext">T4. Societies should prioritize renewal of established patterns over pursuit of novelty.</p><div class="scale" data-key="T4" data-reverse="true"></div></div>
        <div class="item"><p class="qtext">T5. History will culminate in a decisive transformation.</p><div class="scale" data-key="T5"></div></div>
        <div class="item"><p class="qtext">T6. Time is best understood as oriented toward defined milestones and end-states.</p><div class="scale" data-key="T6"></div></div>
        <div class="item"><p class="qtext">T7. Across generations, the same types of events return with new faces.</p><div class="scale" data-key="T7" data-reverse="true"></div></div>
        <div class="item"><p class="qtext">T8. “Progress” is mostly a change of form; core problems recur.</p><div class="scale" data-key="T8" data-reverse="true"></div></div>
        <div class="item"><p class="qtext">T9. When preservation and innovation conflict, innovation should generally lead.</p><div class="scale" data-key="T9"></div></div>
        <div class="item"><p class="qtext">T10. Cyclical rhythms (seasons, rites, returns) are a more accurate model of time than linear advance.</p><div class="scale" data-key="T10" data-reverse="true"></div></div>
      </fieldset>

      <fieldset class="a-fields">
        <legend>Agency Orientation (A)</legend>
        <p class="muted">1 = Strongly disagree… 7 = Strongly agree</p>

        <div class="item"><p class="qtext">A1. Deliberate choice can substantially redirect life trajectories.</p><div class="scale" data-key="A1"></div></div>
        <div class="item"><p class="qtext">A2. Outcomes are largely fixed by structures (institutions, class, biology) beyond personal control.</p><div class="scale" data-key="A2" data-reverse="true"></div></div>
        <div class="item"><p class="qtext">A3. Collective action achieves results that individuals alone cannot.</p><div class="scale" data-key="A3"></div></div>
        <div class="item"><p class="qtext">A4. People mostly enact roles assigned by circumstances, with limited room to redefine them.</p><div class="scale" data-key="A4" data-reverse="true"></div></div>
        <div class="item"><p class="qtext">A5. Well-designed systems decrease reliance on personal willpower.</p><div class="scale" data-key="A5"></div></div>
        <div class="item"><p class="qtext">A6. Chance and luck are dominant drivers of life outcomes.</p><div class="scale" data-key="A6" data-reverse="true"></div></div>
        <div class="item"><p class="qtext">A7. Decisive authority is sometimes necessary to avoid diffusion of responsibility.</p><div class="scale" data-key="A7"></div></div>
        <div class="item"><p class="qtext">A8. Allowing processes to self-organize often produces better results than direct control.</p><div class="scale" data-key="A8"></div></div>
        <div class="item"><p class="qtext">A9. Moral responsibility rests primarily on individuals rather than systems.</p><div class="scale" data-key="A9"></div></div>
        <div class="item"><p class="qtext">A10. When harms occur, the first place to assign responsibility is system design, not individual actors.</p><div class="scale" data-key="A10" data-reverse="true"></div></div>
      </fieldset>

      <fieldset class="o-fields">
        <legend>Ontological Continuity (O)</legend>
        <p class="muted">1 = Strongly disagree… 7 = Strongly agree</p>

        <div class="item"><p class="qtext">O1. Moral truths ultimately depend on a reality that is not created by humans.</p><div class="scale" data-key="O1"></div></div>
        <div class="item"><p class="qtext">O2. Meaning and value arise chiefly from right relationship among persons, communities, and the natural world.</p><div class="scale" data-key="O2" data-reverse="true"></div></div>
        <div class="item"><p class="qtext">O3. The highest good requires alignment with something beyond the human world.</p><div class="scale" data-key="O3"></div></div>
        <div class="item"><p class="qtext">O4. Treating “spiritual” and “material” as separate domains leads to error.</p><div class="scale" data-key="O4" data-reverse="true"></div></div>
        <div class="item"><p class="qtext">O5. Boundaries between self, others, and world are ultimately conventional.</p><div class="scale" data-key="O5" data-reverse="true"></div></div>
        <div class="item"><p class="qtext">O6. Moral authority properly descends from beyond human agreement.</p><div class="scale" data-key="O6"></div></div>
        <div class="item"><p class="qtext">O7. Nature is a sufficient ground for meaning and value.</p><div class="scale" data-key="O7" data-reverse="true"></div></div>
        <div class="item"><p class="qtext">O8. Claims of non-duality or mystical union indicate contact with something real.</p><div class="scale" data-key="O8"></div></div>
        <div class="item"><p class="qtext">O9. Human purpose is primarily obedience or service to a reality above the world.</p><div class="scale" data-key="O9"></div></div>
        <div class="item"><p class="qtext">O10. Truth claims should be justified within human inquiry without appeal to a transcendent source.</p><div class="scale" data-key="O10" data-reverse="true"></div></div>
      </fieldset>

      <div class="actions">
        <button type="button" id="computeBtn">Compute</button>
        <button type="button" id="clearBtn">Clear</button>
        <button type="button" id="saveBtn" title="Download your responses as JSON">Save JSON</button>
        <button type="button" id="csvBtn" title="Download T/A/O scores as CSV">Export CSV</button>
        <button type="button" id="shareBtn" title="Copy a shareable URL with your answers encoded">Share Link</button>
        <button type="button" id="printBtn" title="Print a one-page report">Print</button>
      </div>
    </form>
  </section>

  <section class="card scroll">
    <h2 class="title">Results + Reference Points</h2>
    <div class="results">
      <div class="pill"><div class="mini">T (Temporal)</div><div class="big" id="Tscore">—</div><div class="mini" id="Tlabel"></div></div>
      <div class="pill"><div class="mini">A (Agency)</div><div class="big" id="Ascore">—</div><div class="mini" id="Alabel"></div></div>
      <div class="pill"><div class="mini">O (Ontology)</div><div class="big" id="Oscore">—</div><div class="mini" id="Olabel"></div></div>
    </div>
    <div class="typeBox">
      <div class="mini">Type (octant)</div>
      <div id="typeLabel" style="font-weight:800;margin-top:4px">—</div>
      <div class="mini" id="kvs"></div>
    </div>
    <div style="margin-top:10px; position: relative;">
      <canvas id="plot3d" aria-label="3D TAO scatter"></canvas>
      <div class="legend">
        <div style="color: #6cc6ff"><b>T axis:</b> −1 Linear ↔ +1 Cyclical</div>
        <div style="color: #6ee7a2"><b>A axis:</b> −1 Deterministic ↔ +1 Volitional/Participatory</div>
        <div style="color: #ffb86b"><b>O axis:</b> −1 Transcendent/Dualistic ↔ +1 Immanent/Relational</div>
        <div>Drag to rotate · Scroll to zoom · Double‑click to re‑center · Click a point for details</div>
      </div>
      <div id="tooltip" class="tooltip" role="status" aria-live="polite"></div>
    </div>

     <table>
      <tr>
        <td class="legend-row" data-category="religion">Religion <span class="dot" style="background:#6cc6ff"></span></td>
        <td class="legend-row" data-category="philosophy">Philosophy <span class="dot" style="background:#6ee7a2"></span></td>
      </tr>
      <tr>
        <td class="legend-row" data-category="mysticism">Mysticism <span class="dot" style="background:#ffb86b"></span></td>
        <td class="legend-row" data-category="modern">Modern <span class="dot" style="background:#ff7b7b"></span></td>
      </tr>
      <tr>
        <td class="legend-row" data-category="politics">Politics/Leaders <span class="dot" style="background:#c792ea"></span></td>
        <td class="legend-row" data-category="science">Science/Other <span class="dot" style="background:#f2cc60"></span></td>
      </tr>
    </table>
  </section>
</main>

<script type="module">
import * as THREE from 'three';
import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

/* Build Likert scales */
(function buildScales() {
  document.querySelectorAll('.scale').forEach(sc => {
    const key = sc.dataset.key;
    for (let v = 1; v <= 7; v++) {
      const id = key + '_' + v;
      const input = document.createElement('input'); input.type='radio'; input.name=key; input.id=id; input.value=String(v);
      const label = document.createElement('label'); label.htmlFor=id; label.textContent=v;
      sc.appendChild(input); sc.appendChild(label);
    }
  });
})();

/* Scoring */
const T_reverse = new Set(document.querySelectorAll('.t-fields .scale[data-reverse]'));
const A_reverse = new Set(document.querySelectorAll('.a-fields .scale[data-reverse]'));
const O_reverse = new Set(document.querySelectorAll('.o-fields .scale[data-reverse]'));
const AXES = {
  T:{items:['T1','T2','T3','T4','T5','T6','T7','T8','T9','T10'], reverse:T_reverse},
  A:{items:['A1','A2','A3','A4','A5','A6','A7','A8','A9','A10'], reverse:A_reverse},
  O:{items:['O1','O2','O3','O4','O5','O6','O7','O8','O9','O10'], reverse:O_reverse}
};

const CSV_TRADITIONS = `
name,category,tradition,subtype,T,A,O,year,notes
Judaism (Biblical),religion,Judaism,Biblical,-0.85,0.4,-0.8,-1000,Linear covenant; divine law; transcendent Yahweh.
Judaism (Rabbinic),religion,Judaism,Rabbinic,-0.8,0.4,-0.7,200,Halakhic continuity; ethical law; transcendence.
Kabbalah (Jewish Mysticism),mysticism,Judaism,Kabbalah,0.0,0.0,0.9,1200,Ein Sof; sefirot; emanation.
Hasidic Judaism,religion,Judaism,Hasidic,-0.8,0.5,-0.6,1750,Joyful devotion; immanence via mitzvot.
Reform Judaism,modern,Judaism,Reform,-0.6,0.6,-0.4,1850,Ethical monotheism; modern adaptation.
Reconstructionist Judaism,modern,Judaism,Reconstructionist,-0.5,0.7,-0.3,1930,Evolving civilization; communal immanence.
Christianity (Catholic),religion,Christianity,Catholic,-0.8,0.5,-0.6,100,Grace/sacraments; transcendence.
Christianity (Orthodox),religion,Christianity,Orthodox,-0.8,0.5,-0.4,400,Theosis; mystical union.
Christianity (Mainline Protestant),religion,Christianity,Mainline Protestant,-0.7,0.6,-0.5,1550,Teleology + ethics; balanced agency.
Christianity (Evangelical),religion,Christianity,Evangelical,-0.85,0.8,-0.7,1750,Conversional agency; divine plan.
Christianity (Pentecostal),religion,Christianity,Pentecostal,-0.8,0.9,-0.6,1906,Spirit-led agency; miracles.
Christianity (Reformed/Calvinist),religion,Christianity,Reformed/Calvinist,-0.85,-0.3,-0.7,1550,Predestination; sovereignty.
Christianity (Liberation),religion,Christianity,Liberation,-0.4,0.8,-0.1,1970,Latin American liberation theology; praxis of the poor; God in history and justice.
Christian Mysticism,mysticism,Christianity,Mysticism,0.0,0.0,1.0,1200,Union with God; apophatic path.
Mormonism (LDS),religion,Christianity,LDS,-0.7,0.6,0.1,1830,Restoration; exaltation; material–spiritual continuity.
Islam (Sunni),religion,Islam,Sunni,-0.8,0.5,-0.8,630,Prophetic history; sharia; transcendence.
Islam (Shia),religion,Islam,Shia,-0.8,0.5,-0.8,680,Imamate; martyrdom.
Islam (Sufi),mysticism,Islam,Sufi,0.0,0.0,1.0,800,Fanā’/baqā’; unity mysticism.
Islam (Ismaili),religion,Islam,Ismaili,-0.7,0.4,-0.6,760,Esoteric imamology.
Islam (Salafi),religion,Islam,Salafi,-0.85,0.3,-0.85,1740,Scripturalism; determinism.
Islam (Ahmadiyya),religion,Islam,Ahmadiyya,-0.75,0.6,-0.6,1889,Reformist; moderated transcendence.
Zoroastrianism,religion,Zoroastrianism,Classical,-0.8,0.5,-0.6,-1000,Cosmic dualism; Ahura Mazda.
Manichaeism,religion,Manichaeism,Classical,-0.7,0.4,-0.8,250,Eternal dualism; matter–spirit conflict.
Gnosticism (classical),mysticism,Gnosticism,Classical,-0.6,0.3,-0.9,150,Divine spark; gnosis.
Hinduism (Vedanta-general),religion,Hinduism,Vedanta (General),0.7,0.0,0.8,-500,Cycles; dharma/karma; Brahman.
Advaita Vedanta,mysticism,Hinduism,Advaita Vedanta,0.0,0.0,1.0,800,Non-dual realization.
Hinduism (Bhakti),religion,Hinduism,Bhakti,0.5,0.6,0.5,1200,Devotion within cyclical order.
Hinduism (Tantric),mysticism,Hinduism,Tantric,0.4,0.7,0.3,900,Participatory ritual; sacred immanence.
Sikhism,religion,Sikhism,Main,0.4,0.5,0.2,1500,Naam; devotion + ethics.
Jainism,religion,Jainism,Main,0.8,-0.4,0.7,-500,Karmic determinism; ascetic liberation.
Buddhism (Theravada),religion,Buddhism,Theravada,0.6,-0.2,0.8,-400,Rebirth; anatta.
Buddhism (Mahayana),religion,Buddhism,Mahayana,0.4,0.1,0.95,100,Śūnyatā; non-duality.
Buddhism (Vajrayana),mysticism,Buddhism,Vajrayana,0.3,0.6,0.7,700,Tantric participation.
Daoism (Taoism),religion,Daoism,Classical,0.7,0.6,0.9,-400,Wu-wei; spontaneous order.
Confucianism,philosophy,Confucianism,Classical,0.5,0.6,0.3,-500,Ritual harmony; relational virtue.
Shinto,religion,Shinto,Classical,0.7,0.5,0.9,700,Participatory rituals; kami.
Indigenous Animism,religion,Indigenous,Animism,0.8,0.6,0.9,-10000,Reciprocity with land/spirits.
Hermeticism,mysticism,Esoteric,Hermeticism,0.3,0.7,0.0,200,As above so below; ascent.
Neoplatonism,philosophy,Hellenic,Neoplatonism,-0.2,0.4,-0.6,250,Emanation from the One.
Stoicism,philosophy,Hellenic,Stoicism,-0.2,0.6,0.4,-300,Fated logos; inner agency.
Aristotelianism,philosophy,Hellenic,Aristotelianism,-0.3,0.5,0.3,-330,Natural teleology.
Existentialism,philosophy,Modern,Existentialism,-0.5,0.8,0.2,1850,Radical freedom; immanent meaning.
Nietzsche (Eternal Recurrence),philosophy,Modern,Nietzschean,0.6,0.9,0.2,1885,Affirm recurrence; creative will.
Marxist Materialism,modern,Modern,Marxist Materialism,-0.6,-0.2,0.6,1848,Deterministic structures; immanent.
Secular Humanism,modern,Modern,Secular Humanism,-0.6,0.7,0.7,1850,Progress; agency; immanent ethics.
Enlightenment Rationalism,modern,Modern,Enlightenment Rationalism,-0.7,0.6,0.5,1700,Reason/rights; empirical order.
Gaiaism / Deep Ecology,modern,Modern,Deep Ecology,0.6,0.5,0.95,1970,Planetary cycles; reciprocity.
Transhumanism,modern,Modern,Transhumanism,-0.5,0.9,0.1,1990,Technological will to transcend limits.
Scientology,modern,New Religious Movements,Scientology,-0.4,0.7,-0.2,1953,Auditing; thetan/body dualism.
New Age / Pantheism,modern,New Religious Movements,New Age/Pantheism,0.5,0.5,0.9,1970,Holistic cycles; participatory agency.
Bahá’í Faith,religion,Bahá’í,Main,-0.7,0.6,-0.5,1863,Progressive revelation; unity.
Process Theology,theology,Modern,Process,-0.4,0.7,0.5,1920,God as evolving process.
Atheist Physicalism,modern,Modern,Physicalism,-0.7,-0.3,0.6,1770,Deterministic naturalism; immanent cosmos.
Absurdism,philosophy,Modern,Absurdism,-0.6,0.6,0.1,1942,Meaning through revolt.
Postmodern Relativism,modern,Modern,Postmodern Relativism,0.0,0.2,0.4,1970,Deconstruction of metanarratives.
Ancient Egyptian,religion,Egyptian,State Religion,0.7,0.4,0.8,-2500,Maʿat/cosmic order; Nile cycles; participatory rites; immanent sacred within state theology.
Mesopotamian (Sumerian/Akkadian),religion,Mesopotamian,State Religion,0.6,0.2,0.6,-2200,Seasonal/astral cycles with fate (šīmtu); temple economy; immanent-yet-ordained cosmos.
Canaanite/Phoenician,religion,Canaanite,Polytheism,0.7,0.5,0.7,-1200,Storm/sea and fertility cults (Baʿal/Asherah); ritual renewal; kinship with land/sea.
Hittite/Anatolian,religion,Anatolian,Polytheism,0.6,0.3,0.6,-1500,Storm-god pantheon; treaty oaths; agrarian cycles; ritual maintenance of order.
Hellenic Polytheism (Classical),religion,Hellenic,Polytheism (Classical),0.5,0.4,0.6,-700,Civic cults; oracles & Moira; immanent gods entwined with polis.
Orphism (Greek),mysticism,Hellenic,Orphism,0.3,0.4,0.7,-500,Soul purification & rebirth; initiatory myth; cyclical cosmos.
Eleusinian Mysteries,mysticism,Hellenic,Eleusinian,0.4,0.5,0.8,-600,Demeter–Persephone cycle; initiatory renewal; experiential immanence.
Roman State Religion,religion,Roman,State Religion,0.5,0.5,0.6,-200,Pax deorum via rites/auspices; civic reciprocity with gods; pragmatic immanence.
Roman Mithraism,mysticism,Roman,Mithraism,0.4,0.6,0.6,150,Solar/astral grades; initiatory agency; moral discipline within cosmic cycle.
Early Vedic (Ṛgvedic),religion,Hinduism,Early Vedic,0.6,0.5,0.7,-1200,Ṛta (order) via sacrifice; cyclical fire/sky cult; immanence trending to later Vedānta.
Celtic (Druidic),religion,Celtic,Druidic,0.7,0.6,0.9,-300,Animist groves; seasonal feasts; land-relation and participation.
Norse/Germanic,religion,Norse/Germanic,Polytheism,0.3,0.6,0.7,900,Cycles toward Ragnarök; warrior agency; immanent pantheon/land-wights.
Thracian/Daсian (Zalmoxian),religion,Thracian/Dacian,Zalmoxian,0.5,0.5,0.7,-400,Immortality cult; communal rites; immanent underworld/sky links.
Etruscan,religion,Etruscan,State Religion,0.5,0.4,0.6,-600,Divination (haruspicy); civic-portent logic; immanent omen-bound order.
Minoan (Aegean),religion,Minoan,Aegean,0.7,0.5,0.8,-1700,Peak sanctuaries; fertility & maritime cycles; goddess-centric immanence.
Scythian/Sarmatian (Steppe),religion,Steppe,Scythian/Sarmatian,0.5,0.6,0.7,-500,Shamanic-royal cults; sky/horse symbolism; mobile cyclical rites.
`.trim();

const CSV_FIGURES = `
name,category,tradition,T,A,O,year,notes
Ptahhotep,philosophy,Egyptian,0.7,0.3,0.7,-2350,Egyptian vizier; Maʿat ethics; cyclical order through right speech and hierarchy.
Imhotep,science,Egyptian,0.6,0.4,0.7,-2650,Architect-healer; pragmatic wisdom; divine immanence through craft.
Hammurabi,politics,Mesopotamian,-0.7,0.5,-0.7,-1750,Lawgiver; linear justice under transcendent code.
Zoroaster (Zarathustra),religion,Zoroastrianism,-0.8,0.5,-0.6,-1000,Prophet of dualism; moral choice within linear cosmic battle.
Laozi,philosophy,Daoism,0.7,0.6,0.9,-400,Wu-wei; immanent Dao.
Zhuangzi,philosophy,Daoism,0.7,0.7,0.9,-350,Relativism of perspectives; spontaneous harmony with Dao.
Confucius,philosophy,Confucianism,0.5,0.6,0.3,-500,Ritual virtue; relational order; immanent ethics.
Mozi,philosophy,Confucianism,0.5,0.6,0.2,-450,Utilitarian impartial love; social engineering; pragmatic immanence.
Mencius,philosophy,Confucianism,0.5,0.6,0.3,-350,Innate goodness; moral cultivation; immanent virtue.
Han Feizi,politics,Legalist,0.5,0.5,0.0,-240,Legalist determinism; state order via law; minimal transcendence.
Buddha (Gautama Śākyamuni),religion,Buddhism,0.6,0.1,0.9,-500,Middle Way; liberation through insight; causal immanence.
Mahāvīra,religion,Jainism,0.8,-0.4,0.7,-500,Karmic determinism; ascetic liberation.
Pythagoras,philosophy,Hellenic,-0.4,0.5,-0.5,-520,Mathematical harmony; soul transmigration; mixed transcendence.
Heraclitus,philosophy,Hellenic,0.3,0.6,0.4,-500,Flux and logos; cyclic unity of opposites; immanent process.
Parmenides,philosophy,Hellenic,-0.5,0.3,-0.7,-480,Being as unchanging; transcendence of appearance.
Empedocles,philosophy,Hellenic,0.2,0.5,0.5,-460,Four roots and Love/Strife cycles; semi-immanent cosmology.
Anaxagoras,philosophy,Hellenic,-0.3,0.5,-0.4,-450,Nous ordering matter; dualist teleology.
Socrates,philosophy,Hellenic,-0.4,0.6,-0.4,-400,Moral inquiry; daimonion; rational agency.
Plato,philosophy,Hellenic,-0.4,0.4,-0.7,-380,World of Forms; ascent to the Good.
Aristotle,philosophy,Hellenic,-0.3,0.5,0.3,-340,Immanent forms; teleology.
Diogenes of Sinope,philosophy,Hellenic,0.2,0.8,0.4,-350,Cynic naturalism; individual freedom; immanent simplicity.
Epicurus,philosophy,Hellenic,-0.3,0.7,0.5,-300,Atomism; pleasure as tranquility; immanent materialism.
Zeno of Citium (early Stoic),philosophy,Hellenic,-0.2,0.6,0.4,-300,Fated logos; virtue through reason.
Pyrrho,philosophy,Hellenic,-0.1,0.4,0.5,-300,Skepticism; ataraxia; neutral immanence.
Ashoka,politics,Buddhism,0.5,0.4,0.7,-250,Buddhist emperor; dharma governance; moral immanence.
Xunzi,philosophy,Confucianism,0.5,0.5,0.2,-240,Human nature as selfish; ritual discipline; structural order.
Archimedes,science,Hellenic,-0.4,0.7,0.3,-250,Mathematics and mechanics; immanent laws of nature.
Cicero,politics,Roman,-0.5,0.6,0.3,-50,Stoic republicanism; reason and law.
Philo of Alexandria,religion,Judaism,-0.6,0.5,-0.5,20,Hellenistic Judaism; Logos as mediator; transcendence.
Jesus of Nazareth,religion,Christianity,-0.8,0.7,-0.7,30,Kingdom of God; inner agency; transcendent love.
Paul the Apostle,religion,Christianity,-0.8,0.7,-0.7,55,Universal salvation history; will under grace.
Nāgārjuna,philosophy,Buddhism,0.4,0.1,0.95,200,Emptiness; two truths; non-duality.
Plotinus (Neoplatonism),philosophy,Hellenic,-0.2,0.4,-0.7,250,Emanation; mystical ascent.
Origen,religion,Christianity,-0.7,0.5,-0.6,250,Christian Platonism; rational soul ascent.
Mani,religion,Manichaeism,-0.7,0.4,-0.8,250,Manichaeism; cosmic dualism of light/dark.
Augustine of Hippo,religion,Christianity,-0.8,0.5,-0.7,400,Grace; linear salvation.
Boethius,philosophy,Christianity,-0.6,0.4,-0.5,520,*Consolation of Philosophy*; Providence vs free will.
Gregory of Nyssa,religion,Christianity,-0.7,0.5,-0.5,380,Apophatic mysticism; spiritual ascent.
Dionysius the Areopagite,religion,Christianity,-0.7,0.4,-0.6,500,Negative theology; hierarchies of being.
Bede the Venerable,science,Christianity,-0.6,0.5,-0.3,730,Computus of Easter; sacred chronology.
Shankara (Ādi Śaṅkara),philosophy,Hinduism,0.0,0.0,1.0,800,Advaita Vedānta; non-dual realization.
Charlemagne,politics,Christianity,-0.7,0.6,-0.5,800,Imperial Christendom; moral order by decree.
Avicenna (Ibn Sīnā),philosophy,Islam,-0.6,0.5,-0.5,1020,Islamic Peripatetic; necessary being; transcendence.
Al-Farabi,philosophy,Islam,-0.6,0.5,-0.4,950,Islamic Aristotelianism; rational cosmos.
Al-Ghazālī,religion,Islam,-0.7,0.5,-0.6,1100,Sufi theologian; occasionalism; transcendence through surrender.
Anselm of Canterbury,religion,Christianity,-0.7,0.5,-0.6,1080,Ontological proof; rational faith.
Averroes (Ibn Rushd),philosophy,Islam,-0.6,0.6,-0.4,1180,Commentator on Aristotle; unity of intellect.
Maimonides,religion,Judaism,-0.7,0.5,-0.6,1180,Jewish Aristotelianism; negative theology.
Ibn Arabi,mysticism,Islam,0.1,0.3,0.9,1200,Unity of Being (*wahdat al-wujūd*); pure immanence.
Aquinas,religion,Christianity,-0.7,0.5,-0.6,1275,Scholastic synthesis; natural law.
Longchenpa,philosophy,Buddhism,0.4,0.3,0.9,1350,Dzogchen; spontaneous presence; immanence of mind.
Luther,religion,Christianity,-0.8,0.7,-0.7,1517,Justification by faith.
Calvin,religion,Christianity,-0.85,-0.3,-0.7,1550,Predestination; sovereignty.
Francis Bacon,science,Modern,-0.6,0.7,0.5,1620,Experimental method.
Descartes,philosophy,Modern,-0.6,0.7,-0.6,1640,Dualism; methodic doubt; will.
Hobbes,philosophy,Modern,-0.6,0.5,0.2,1651,Mechanism; contract; immanence.
Spinoza,philosophy,Modern,0.0,0.6,0.8,1677,Substance monism; immanence.
Newton,science,Modern,-0.6,0.7,-0.3,1687,Mathematical order; deistic tint.
Locke,philosophy,Modern,-0.6,0.7,0.4,1690,Empiricism; rights.
Hume,philosophy,Modern,-0.5,0.5,0.4,1740,Skepticism; habit.
Rousseau,philosophy,Modern,-0.5,0.7,0.2,1762,Natural goodness; general will.
Jefferson,politics,Modern,-0.6,0.8,0.4,1776,Enlightenment republicanism.
Washington,politics,Modern,-0.6,0.7,0.3,1789,Republican virtue.
Kant,philosophy,Modern,-0.6,0.6,-0.3,1785,Transcendental idealism; duty.
Hegel,philosophy,Modern,-0.6,0.6,-0.4,1820,Dialectical history.
Napoleon,politics,Modern,-0.6,0.9,0.1,1804,Will to empire.
Marx,politics,Modern,-0.6,-0.2,0.6,1848,Historical materialism.
Kierkegaard,philosophy,Christianity,-0.7,0.8,-0.6,1843,Leap of faith; subjectivity.
Maxwell (J. C.),science,Modern,-0.5,0.6,-0.2,1865,Field theory; orderly laws.
Darwin,science,Modern,-0.4,0.6,0.6,1859,Natural selection.
Nietzsche,philosophy,Modern,0.6,0.9,0.2,1885,Eternal recurrence; will to power.
Weber,politics,Modern,-0.6,0.6,0.3,1905,Rationalization; disenchantment.
Heidegger,philosophy,Modern,0.0,0.5,0.4,1927,Being-in-the-world; historicity.
Turing,science,Modern,-0.5,0.8,0.6,1936,Computability; mechanization of reason.
Gandhi,politics,Hinduism,0.3,0.8,0.5,1930,Ahimsa; satyagraha.
Camus,philosophy,Modern,-0.5,0.7,0.1,1942,Absurd; revolt.
Sartre,philosophy,Modern,-0.5,0.9,0.2,1943,Radical freedom; immanent meaning.
Simone de Beauvoir,philosophy,Modern,-0.5,0.9,0.2,1949,Existential freedom; situated ethics.
M. L. King Jr.,politics,Christianity,-0.6,0.8,-0.5,1963,Prophetic justice; moral agency.
Derrida,philosophy,Modern,0.0,0.5,0.4,1967,Deconstruction; différance.
Foucault,philosophy,Modern,0.0,0.6,0.4,1975,Power/knowledge; genealogy.
Archbishop Óscar Romero,politics,Christianity,-0.5,0.8,-0.2,1980,Martyr of justice; liberation theology; God of the poor made immanent through action.
Mandela,politics,Modern,-0.5,0.8,0.4,1994,Reconciliation; pragmatic agency.
Pope Gregory I (the Great),religion,Christianity,-0.8,0.4,-0.7,600,Consolidated Western liturgy; Augustinian synthesis; strong transcendence.
Pope Leo III,politics,Christianity,-0.8,0.5,-0.6,800,Crowned Charlemagne; unity of empire and faith; divine sanction.
Pope Nicholas I (the Great),politics,Christianity,-0.8,0.5,-0.6,865,Asserted papal authority; moral law above rulers.
Pope Gregory VII (Hildebrand),politics,Christianity,-0.8,0.5,-0.7,1075,Investiture Controversy; supremacy of spiritual over temporal.
Pope Urban II,politics,Christianity,-0.8,0.5,-0.8,1095,Called First Crusade; militant teleology; transcendent mission.
Pope Innocent III,politics,Christianity,-0.8,0.4,-0.7,1215,Fourth Lateran Council; pinnacle of papal monarchy.
Pope Boniface VIII,politics,Christianity,-0.8,0.3,-0.8,1302,Declared papal supremacy in *Unam Sanctam*.
Pope Clement V,politics,Christianity,-0.8,0.3,-0.8,1310,Avignon Papacy; decline of Rome's temporal control.
Pope Gregory XI,politics,Christianity,-0.8,0.4,-0.7,1377,Returned papacy to Rome; pre-Great Schism.
Pope Martin V,politics,Christianity,-0.7,0.5,-0.6,1420,Ended Great Schism; conciliar balance.
Pope Sixtus IV,politics,Christianity,-0.7,0.5,-0.6,1480,Renaissance patron; humanist arts; cautious immanence.
Pope Leo X,politics,Christianity,-0.7,0.6,-0.6,1513,Patron of humanism; indulgences sparked Reformation.
Pope Paul III,politics,Christianity,-0.7,0.5,-0.6,1540,Council of Trent; Counter-Reformation; codified doctrine.
Pope Pius V,religion,Christianity,-0.8,0.4,-0.6,1570,Tridentine liturgy; discipline; transcendent moralism.
Pope Urban VIII,politics,Christianity,-0.7,0.6,-0.5,1633,Patron of Baroque arts; condemned Galileo; authority vs science.
Pope Benedict XIV,religion,Christianity,-0.7,0.6,-0.5,1750,Enlightenment engagement; early modernity dialogue.
Pope Pius VII,politics,Christianity,-0.7,0.6,-0.5,1800,Negotiated with Napoleon; Church vs secular state.
Pope Gregory XVI,religion,Christianity,-0.8,0.4,-0.6,1832,Opposed liberalism; rejected railways & democracy.
Pope Pius IX,religion,Christianity,-0.8,0.4,-0.7,1864,*Syllabus of Errors*; papal infallibility; anti-modern stance.
Pope Leo XIII,religion,Christianity,-0.7,0.6,-0.3,1891,*Rerum Novarum*; social teaching; turn toward immanence.
Pope Pius X,religion,Christianity,-0.8,0.5,-0.5,1905,Anti-modernist oath; strong transcendence.
Pope Benedict XV,politics,Christianity,-0.7,0.6,-0.4,1915,WWI peace efforts; humanitarian diplomacy.
Pope Pius XI,religion,Christianity,-0.7,0.6,-0.4,1930,*Quadragesimo Anno*; social order; balance hierarchy/agency.
Pope Pius XII,religion,Christianity,-0.7,0.5,-0.5,1940,Diplomacy during WWII; cautious transcendence.
Pope John XXIII,religion,Christianity,-0.6,0.7,-0.3,1962,Vatican II initiator; aggiornamento; participatory reform.
Pope Paul VI,religion,Christianity,-0.6,0.6,-0.3,1968,Implemented Vatican II; humanistic but conservative ethics.
Pope John Paul I,religion,Christianity,-0.6,0.7,-0.2,1978,"Smiling Pope"; pastoral openness; brief papacy.
Pope John Paul II,religion,Christianity,-0.7,0.7,-0.4,1980,Personalist theology; moral agency; global evangelism.
Pope Benedict XVI,religion,Christianity,-0.7,0.5,-0.5,2005,Faith & reason synthesis; conservative transcendence.
Pope Francis,religion,Christianity,-0.5,0.8,0.1,2013,Integral ecology; mercy; immanent social spirituality.
Prophet Muhammad,religion,Islam,-0.8,0.5,-0.8,630,Revelation of Qur'an; linear salvation history; submission to transcendent God.
Ali ibn Abi Talib,politics,Islam,-0.8,0.6,-0.7,660,First Shia Imam; justice and moral agency under divine sovereignty.
Hasan al-Basri,religion,Islam,-0.8,0.5,-0.7,728,Early asceticism; fear of judgment; free will within divine knowledge.
Jaʿfar al-Sadiq,religion,Islam,-0.7,0.6,-0.6,760,6th Shia Imam; rational jurisprudence; balance of will and order.
Abu Hanifa,religion,Islam,-0.7,0.6,-0.6,767,Hanafi school founder; reason in law; moderate transcendence.
Malik ibn Anas,religion,Islam,-0.8,0.5,-0.7,795,Medina traditionist; preservation of precedent; transcendence.
Al-Shafiʿi,religion,Islam,-0.8,0.5,-0.7,820,Unified legal methodology; revelation over reason.
Ahmad ibn Hanbal,religion,Islam,-0.8,0.4,-0.8,855,Literalist traditionalism; strict transcendence.
Al-Maturidi,religion,Islam,-0.7,0.6,-0.6,870,Sunni rationalism; free will reconciled with divine decree.
Al-Ashʿari,religion,Islam,-0.7,0.5,-0.7,935,Orthodox synthesis; occasionalism; transcendence.
Al-Farabi,philosophy,Islam,-0.6,0.5,-0.4,950,Islamic Aristotelianism; rational cosmos.
Avicenna (Ibn Sina),philosophy,Islam,-0.6,0.5,-0.5,1020,Philosophical rationalism; necessary being; transcendent intellect.
Al-Ghazali,religion,Islam,-0.7,0.5,-0.6,1100,Integrated mysticism with orthodoxy; surrender through awareness.
Ibn Rushd (Averroes),philosophy,Islam,-0.6,0.6,-0.4,1180,Commentator on Aristotle; reason-faith synthesis; mild immanence.
Ibn Arabi,mysticism,Islam,0.1,0.3,0.9,1200,*Wahdat al-wujūd*; unity of being; full immanence.
Rumi,mysticism,Islam,0.2,0.6,0.9,1250,Sufi poet; love as unifying divine energy; cyclical immanence.
Nasir al-Din al-Tusi,philosophy,Islam,-0.6,0.6,-0.4,1260,Shia philosopher-scientist; reconciliation of reason and faith.
Ibn Taymiyyah,religion,Islam,-0.8,0.5,-0.8,1325,Literalism; divine will absolute; anti-speculative transcendence.
Al-Suyuti,religion,Islam,-0.7,0.6,-0.5,1500,Scholar of synthesis; moderate traditionalism.
Shah Waliullah Dehlawi,religion,Islam,-0.6,0.6,-0.3,1750,Islamic renewal; sociological understanding of revelation.
Muhammad ibn Abd al-Wahhab,politics,Islam,-0.8,0.4,-0.8,1740,Reformist literalism; puritan transcendence.
Jamal al-Din al-Afghani,politics,Islam,-0.6,0.7,-0.2,1880,Pan-Islamic modernism; rationalist revival; participatory agency.
Muhammad Abduh,religion,Islam,-0.6,0.7,-0.2,1900,Reformist theology; reason as divine gift; immanent ethics.
Rashid Rida,religion,Islam,-0.6,0.6,-0.3,1910,Salafi reformer; modernist hermeneutic.
Hasan al-Banna,politics,Islam,-0.6,0.7,-0.3,1930,Founder Muslim Brotherhood; social justice and divine order.
Sayyid Qutb,politics,Islam,-0.7,0.7,-0.6,1955,Ideological Islamism; transcendent law over secular agency.
Ali Shariati,philosophy,Islam,-0.5,0.8,-0.1,1970,Shia liberation theologian; synthesis of faith and revolution.
Ayatollah Khomeini,politics,Islam,-0.6,0.6,-0.5,1979,Velayat-e faqih; divine authority through clerical agency.
Seyyed Hossein Nasr,philosophy,Islam,-0.4,0.6,-0.1,1990,Traditionalist metaphysics; sacred science; participatory cosmology.
Fethullah Gülen,religion,Islam,-0.4,0.8,0.1,2000,Dialogical Islam; education and service; immanent cooperation.
Abraham,religion,Judaism,-0.9,0.5,-0.8,-1800,Covenantal origin; linear promise; obedience to transcendent God.
Moses,religion,Judaism,-0.9,0.5,-0.8,-1250,Exodus narrative; lawgiving; historical teleology under divine command.
Isaiah,religion,Judaism,-0.8,0.6,-0.7,-700,Prophetic justice; moral agency within covenant history.
Ezra the Scribe,religion,Judaism,-0.8,0.4,-0.7,-450,Restoration law; scriptural canonization; historical transcendence.
Hillel the Elder,philosophy,Judaism,-0.7,0.6,-0.5,-20,Ethics of reciprocity; participatory law; immanent compassion within halakhah.
Rabbi Akiva,religion,Judaism,-0.7,0.6,-0.6,120,Martyrdom & mysticism; inner Torah unity; partial immanence.
Rabbi Judah ha-Nasi,religion,Judaism,-0.7,0.6,-0.6,200,Redaction of Mishnah; law as living order; balance of agency and obedience.
Saadia Gaon,religion,Judaism,-0.7,0.5,-0.6,930,Jewish rationalism; reason & revelation harmony; moderate transcendence.
Solomon Ibn Gabirol (Avicebron),philosophy,Judaism,-0.6,0.5,-0.5,1050,Neoplatonic emanation; divine will; proto-Kabbalistic thought.
Rashi,religion,Judaism,-0.7,0.6,-0.6,1100,Torah commentary; textual participation; lived halakhic immanence.
Judah Halevi,philosophy,Judaism,-0.7,0.5,-0.7,1140,*Kuzari*; experiential faith over philosophy; divine transcendence.
Maimonides (Rambam),philosophy,Judaism,-0.7,0.5,-0.6,1180,Aristotelian synthesis; negative theology; rational transcendence.
Nachmanides (Ramban),philosophy,Judaism,-0.6,0.6,-0.3,1250,Integrates mysticism into law; partial immanence.
Abraham Abulafia,mysticism,Judaism,-0.2,0.5,0.9,1280,Prophetic Kabbalah; ecstatic union through language.
Isaac Luria (Ari),mysticism,Judaism,0.0,0.5,0.9,1570,Lurianic Kabbalah; tzimtzum & repair; cyclical creation; strong immanence.
Joseph Caro,religion,Judaism,-0.6,0.5,-0.5,1560,*Shulchan Aruch*; codified law; disciplined transcendence.
Baal Shem Tov (Besht),mysticism,Judaism,0.3,0.7,0.8,1740,Founder Hasidism; divine spark in all; joyous immanence.
Vilna Gaon,religion,Judaism,-0.6,0.6,-0.4,1780,Opposed Hasidism; rational-mystical synthesis; moderate transcendence.
Moses Mendelssohn,philosophy,Judaism,-0.6,0.7,-0.2,1775,Jewish Enlightenment; ethics & reason; participatory rationalism.
Herman Cohen,philosophy,Judaism,-0.6,0.6,-0.2,1900,Neo-Kantian idealism; ethical monotheism; transcendence in reason.
Martin Buber,philosophy,Judaism,0.0,0.8,0.6,1923,*I-Thou* relation; dialogical immanence; encounter theology.
Abraham Joshua Heschel,religion,Judaism,-0.3,0.8,0.3,1965,Prophetic pathos; participatory God-human partnership.
Rabbi Menachem Mendel Schneerson (Lubavitcher Rebbe),mysticism,Judaism,0.1,0.8,0.6,1980,Hasidic activism; divine immanence in world action.
Rabbi Mordecai Kaplan,religion,Judaism,-0.4,0.7,-0.1,1935,Founder Reconstructionism; God as process; communal immanence.
Emmanuel Levinas,philosophy,Judaism,-0.4,0.8,0.2,1970,Ethics as first philosophy; transcendence through relation.
Rabbi Jonathan Sacks,religion,Judaism,-0.5,0.8,0.1,2005,Dialogical modern orthodoxy; covenantal pluralism; immanent ethics.
Buddhaghosa,philosophy,Buddhism,0.6,0.1,0.8,450,Author of Visuddhimagga; analytic path; insight & discipline.
Aśaṅga,philosophy,Buddhism,0.5,0.3,0.9,350,Consciousness-only; bodhisattva path; gradated cultivation.
Vasubandhu,philosophy,Buddhism,0.5,0.3,0.9,400,Abhidharmika turned Yogācāra; mind-only analysis.
Śāntideva,philosophy,Buddhism,0.5,0.7,0.9,750,*Bodhicaryāvatāra*; compassion/emptiness praxis.
Bodhidharma,mysticism,Buddhism,0.4,0.6,0.95,520,Direct pointing to mind; meditation and insight.
Huineng (6th Patriarch),mysticism,Buddhism,0.4,0.7,0.95,670,Sudden enlightenment; non-dual everyday mind.
Zhiyi (Tiantai),philosophy,Buddhism,0.5,0.5,0.85,600,Threefold truth; contemplation syntheses.
Xuanzang,philosophy,Buddhism,0.5,0.4,0.85,650,Translator/pilgrim; Yogācāra systematizer.
Śāntarakṣita,philosophy,Buddhism,0.5,0.4,0.85,775,Integrative Madhyamaka with logic and tantra preface.
Padmasambhava,mysticism,Buddhism,0.4,0.6,0.9,800,Tantric master; Dzogchen seeds in Tibet; visionary yoga.
Atiśa,philosophy,Buddhism,0.4,0.5,0.85,1050,Reformist lamrim; ethics + meditation stages.
Milarepa,mysticism,Buddhism,0.5,0.7,0.95,1100,Yogi-poet; austerity to realization; spontaneous presence.
Gampopa,philosophy,Buddhism,0.5,0.5,0.85,1130,Streams Kadam lamrim into Kagyü Mahāmudrā.
Tsongkhapa,philosophy,Buddhism,0.4,0.5,0.9,1400,Prāsaṅgika rigor; ethics & analysis; refined emptiness.
Shinran,philosophy,Buddhism,0.5,0.1,-0.2,1230,Other-power faith in Amitābha; radical reliance.
Hōnen,philosophy,Buddhism,0.5,0.2,-0.2,1210,Nembutsu devotion; accessible path for laity.
Nichiren,politics,Buddhism,0.5,0.8,0.5,1260,Lotus exclusivism; chanting as world-transforming agency.
Kūkai (Kōbō-Daishi),mysticism,Buddhism,0.4,0.6,0.9,820,Mantra/mandala body of Buddha; esoteric immanence.
Saichō (Dengyō-Daishi),philosophy,Buddhism,0.5,0.5,0.85,805,Inclusive Tendai synthesis; vinaya/meditation balance.
Dōgen,mysticism,Buddhism,0.4,0.6,0.95,1240,Shikantaza; practice-realization non-dualism.
Hakuin Ekaku,mysticism,Buddhism,0.4,0.8,0.9,1750,Koan reform; great doubt/great death breakthrough.
14th Dalai Lama (Tenzin Gyatso),politics,Buddhism,0.4,0.6,0.85,1989,Compassion, secular ethics, Madhyamaka diplomacy.
Thich Nhat Hanh,philosophy,Buddhism,0.5,0.8,0.85,1965,Inter-being; mindfulness in social action.
Ajahn Chah,philosophy,Buddhism,0.5,0.4,0.85,1975,Direct simplicity; satipaṭṭhāna & letting-go.
Mahasi Sayadaw,philosophy,Buddhism,0.5,0.6,0.8,1950,Noting method; democratized vipassanā technique.
Shunryu Suzuki,philosophy,Buddhism,0.4,0.6,0.9,1970,Beginner’s mind; everyday practice as realization.
Yājñavalkya,philosophy,Hinduism,0.5,0.3,0.8,-800,Upanishadic sage; early Advaitic insight (‘neti-neti’); self as Brahman.
Uddālaka Āruṇi,philosophy,Hinduism,0.5,0.3,0.8,-700,Teacher of Śvetaketu; “tat tvam asi”; unity of being in Chandogya Upaniṣad.
Kapila,philosophy,Hinduism,0.5,0.3,-0.2,-600,Founder of Sāṃkhya; puruṣa–prakṛti dualism; analytic realism.
Patañjali,philosophy,Hinduism,0.4,0.4,-0.1,-200,Author of Yoga Sūtras; classical Yoga; disciplined transcendence.
Gautama (Akṣapāda),philosophy,Hinduism,0.3,0.4,0.0,-200,Nyāya school founder; logic and inference as paths to truth.
Kaṇāda,philosophy,Hinduism,0.3,0.4,0.1,-200,Vaiśeṣika atomism; natural categories; early scientific realism.
Jaimini,philosophy,Hinduism,0.4,0.5,-0.1,-300,Mīmāṃsā ritualism; dharma through action; atheistic orthodoxy.
Vyāsa (Bādarāyaṇa),philosophy,Hinduism,0.4,0.4,0.6,-200,Author of Brahma Sūtras; Vedānta synthesis.
Adi Śaṅkara,philosophy,Hinduism,0.0,0.0,1.0,800,Advaita Vedānta; non-duality; illusion of separateness.
Rāmānuja,philosophy,Hinduism,0.3,0.5,0.6,1100,Viśiṣṭādvaita Vedānta; devotion within unity; personal theism.
Madhva,philosophy,Hinduism,0.3,0.5,-0.3,1250,Dvaita Vedānta; eternal dualism of God and souls.
Abhinavagupta,mysticism,Hinduism,0.4,0.7,0.8,1000,Kashmir Śaivism; aesthetics of consciousness; divine vibration (spanda).
Basava (Basavanna),mysticism,Hinduism,0.4,0.7,0.6,1160,Liṅgāyat bhakti; equality and work as worship.
Kabir,mysticism,Hinduism,0.4,0.8,0.7,1450,Poet-saint bridging Hindu and Islamic devotion; inner realization.
Tulsidas,philosophy,Hinduism,0.4,0.7,0.6,1600,Rāma bhakti; moral devotion in vernacular poetry.
Mirabai,mysticism,Hinduism,0.5,0.8,0.8,1520,Kṛṣṇa bhakti; ecstatic love and liberation through song.
Chaitanya Mahāprabhu,mysticism,Hinduism,0.4,0.8,0.8,1510,Founder of Gauḍīya Vaiṣṇavism; divine play (līlā) and chanting.
Vallabha Ācārya,philosophy,Hinduism,0.2,0.6,0.8,1500,Śuddhādvaita Vedānta; grace-based joyous non-dualism.
Śaiva Āgamic Teachers,mysticism,Hinduism,0.4,0.7,0.7,900,Śaiva tantra; non-dual consciousness; immanent Śiva.
Swami Vivekananda,philosophy,Hinduism,0.3,0.8,0.8,1893,Neo-Vedānta; social action as spiritual duty; universal Advaita.
Sri Aurobindo,philosophy,Hinduism,0.3,0.8,0.8,1910,Integral yoga; evolution of consciousness; matter’s divinization.
Ramakrishna Paramahamsa,mysticism,Hinduism,0.2,0.7,0.9,1880,Experiential unity of all faiths; direct realization.
Anandamayi Ma,mysticism,Hinduism,0.2,0.8,0.9,1940,Spontaneous realization; divine embodiment; living saint.
Sarvepalli Radhakrishnan,philosophy,Hinduism,0.3,0.7,0.7,1930,Philosopher-president; synthesis of reason and mysticism.
Swami Sivananda,mysticism,Hinduism,0.3,0.6,0.8,1940,Integral Yoga; selfless service (seva) and meditation.
Paramahansa Yogananda,mysticism,Hinduism,0.3,0.8,0.8,1946,Kriyā Yoga; East–West synthesis; *Autobiography of a Yogi*.
Sri Chinmoy,mysticism,Hinduism,0.3,0.8,0.8,1970,Integral Yoga; peace and self-transcendence through art and meditation.
Sathya Sai Baba,mysticism,Hinduism,0.2,0.8,0.8,1975,Modern bhakti teacher; service, love, and avatar ideal.
Ramana Maharshi,mysticism,Hinduism,0.0,0.4,0.9,1930,Advaita realization; self-inquiry (‘Who am I?’); silent transmission.
Nisargadatta Maharaj,mysticism,Hinduism,0.0,0.4,0.9,1970,Non-dual awareness; formless witness consciousness.
Swami Chinmayananda,philosophy,Hinduism,0.1,0.7,0.7,1960,Modern Advaita interpreter; Vedānta for rational audiences.
Sadhguru Jaggi Vasudev,mysticism,Hinduism,0.2,0.8,0.7,2010,Contemporary yogic synthesis; pragmatic mysticism.
Mata Amritanandamayi (Amma),mysticism,Hinduism,0.2,0.8,0.8,2015,Modern bhakti teacher; compassion and service through divine embrace.
Auguste Comte,philosophy,Modern,-0.7,0.5,0.4,1842,Positivism; social physics; empirical law of progress.
William James,philosophy,Modern,-0.2,0.8,0.6,1902,Pragmatism and religious experience; truth as lived verification.
Sigmund Freud,philosophy,Modern,-0.5,0.5,0.3,1900,Psychoanalysis; determinism of unconscious; secular interiority.
Carl Jung,philosophy,Modern,-0.2,0.6,0.8,1920,Archetypes; individuation; psyche as sacred totality.
Albert Einstein,science,Modern,-0.5,0.6,0.5,1915,Relativity; rational cosmos; “God does not play dice.”
Bertrand Russell,philosophy,Modern,-0.6,0.7,0.4,1920,Analytic logic; skeptical empiricism; secular ethics.
Jean-Paul Sartre,philosophy,Modern,-0.5,0.9,0.2,1943,Existential freedom; immanent meaning; radical responsibility.
Simone de Beauvoir,philosophy,Modern,-0.5,0.9,0.2,1949,Feminist existentialism; situated freedom and ethics.
Albert Camus,philosophy,Modern,-0.6,0.6,0.1,1942,Absurdism; revolt as creation of meaning.
Alan Watts,philosophy,Modern,0.2,0.8,0.8,1960,Zen-Taoist popularizer; Western integration of non-duality.
Aldous Huxley,philosophy,Modern,0.1,0.7,0.8,1954,*Perennial Philosophy*; psychedelic mysticism; consciousness exploration.
Erich Fromm,philosophy,Modern,-0.4,0.8,0.6,1950,HUMANIST psychoanalysis; love and freedom as moral creativity.
Abraham Maslow,philosophy,Modern,-0.3,0.8,0.7,1954,Humanistic psychology; self-actualization and peak experience.
Carl Rogers,philosophy,Modern,-0.3,0.9,0.7,1961,Client-centered therapy; organismic trust and empathy.
Buckminster Fuller,science,Modern,0.1,0.8,0.7,1965,Comprehensive design science; synergy; planetary systems view.
Marshall McLuhan,philosophy,Modern,0.1,0.7,0.6,1964,Media as extensions of consciousness; pattern perception.
Pierre Teilhard de Chardin,philosophy,Modern,0.2,0.7,0.8,1955,Noosphere; cosmic Christ; evolution toward unity.
Ken Wilber,philosophy,Modern,0.1,0.8,0.8,1990,Integral theory; synthesis of science and spirituality.
Terence McKenna,philosophy,Modern,0.2,0.9,0.9,1995,Psychedelic consciousness; archaic revival; participatory cosmos.
Ram Dass,mysticism,Modern,0.2,0.9,0.9,1970,*Be Here Now*; love and service; Western bhakti/advaita bridge.
Eckhart Tolle,mysticism,Modern,0.1,0.9,0.9,2000,*Power of Now*; stillness and presence; secular non-duality.
Deepak Chopra,mysticism,Modern,0.1,0.8,0.8,2005,Quantum healing; mind-body unity; modern Vedānta framing.
Rupert Sheldrake,science,Modern,0.1,0.6,0.7,2012,Morphic resonance; participatory science; re-enchanted nature.
Elon Musk,politics,Modern,-0.3,0.9,0.1,2020,Technological will; transhumanist agency; planetary colonization.
Yuval Noah Harari,philosophy,Modern,-0.2,0.8,0.3,2020,Homo Deus; dataism; secular narrative of transcendence.
Marianne Williamson,mysticism,Modern,0.1,0.8,0.8,2010,Course in Miracles teacher; love as social spirituality.
Jordan Peterson,philosophy,Modern,-0.4,0.8,-0.1,2018,Mythic order and moral responsibility; tension between structure and freedom.
Sam Harris,philosophy,Modern,-0.3,0.8,0.6,2020,Secular mindfulness; spirituality without religion.
Rupert Spira,mysticism,Modern,0.0,0.8,0.9,2015,Non-dual awareness; consciousness as all-inclusive reality.
Enheduanna,philosophy,Mesopotamian,0.6,0.2,-0.7,-2300,High priestess of Ur; hymns to Inanna; cosmic order via divine determinism.
Lucretius,philosophy,Hellenic,0.4,0.3,0.6,-50,Atomist poet; *De Rerum Natura*; natural cycles and material immanence.
Marcus Aurelius,philosophy,Stoic,0.2,0.3,0.4,175,Emperor-philosopher; Stoic acceptance; order through reason and fate.
Porphyry,philosophy,Hellenic,0.0,0.4,-0.6,270,Neoplatonic ethicist; rational ascent to divine intellect.
Iamblichus,philosophy,Hellenic,0.1,0.5,-0.7,320,Theurgic mysticism; ritual mediation between worlds.
Tertullian,theology,Christian,-0.9,0.2,-0.8,200,Dogmatic Latin Father; faith over reason; strict transcendence.
Zhu Xi,philosophy,Confucian,0.5,0.3,-0.4,1200,Neo-Confucian synthesis; moral principle (li) as cosmic order.
Wang Yangming,philosophy,Confucian,0.5,0.6,-0.3,1520,Unity of knowing and acting; mind as moral will; participatory idealism.
Hermes Trismegistus,mysticism,Hermetic,0.3,0.6,-0.6,-100,Foundational Hermetic sage; “as above so below”; ascent through gnosis.
Paracelsus,science,Hermetic,0.4,0.6,0.7,1520,Physician-alchemist; divine forces within matter; immanent healing.
Giordano Bruno,philosophy,Hermetic,0.4,0.7,0.8,1600,Infinite cosmos; pantheism; cyclical emanation and return.
Helena Blavatsky,mysticism,Theosophy,0.4,0.7,0.8,1880,Founder of Theosophical Society; esoteric evolution of consciousness.
Rudolf Steiner,philosophy,Anthroposophy,0.4,0.8,0.8,1910,Spiritual science; reincarnation and planetary pedagogy.
Aleister Crowley,mysticism,Occult,0.4,0.8,-0.5,1910,Thelema; magical will; self-deification through ritual.
Eliphas Lévi,mysticism,Occult,0.3,0.7,-0.6,1855,French occult revivalist; *Dogme et Rituel de la Haute Magie*; synthesis of Kabbalah, alchemy, and Christian theurgy.
Dion Fortune,mysticism,Occult,0.4,0.8,-0.4,1935,Founder of Society of Inner Light; psychospiritual occultism bridging mysticism and depth psychology.
Israel Regardie,mysticism,Occult,0.3,0.8,-0.3,1940,Golden Dawn chronicler; integrated ceremonial magic with Jungian psychology; Western Kabbalistic synthesis.
Anton Wilhelm Amo,philosophy,Modern,-0.4,0.7,-0.2,1730,African Enlightenment thinker; rational freedom; proto-humanist.
Kwame Nkrumah,politics,Modern,-0.5,0.7,0.4,1960,Pan-African socialism; consciencism; dialectic of material and spirit.
Léopold Sédar Senghor,philosophy,Modern,0.4,0.7,0.6,1950,Negritude; emotional reason; rhythmic participation in being.
Black Elk,mysticism,Indigenous,0.6,0.8,0.9,1890,Lakota visionary; sacred hoop; cosmic renewal through ritual.
Thomas Berry,philosophy,Modern,0.5,0.8,0.9,1990,Ecotheologian; Universe Story; immanent sacred cosmology.
James Lovelock,science,Modern,0.5,0.3,0.9,1972,Gaia hypothesis; self-regulating biosphere; planetary immanence.
Nikola Tesla,science,Modern,0.3,0.8,0.7,1895,Technological mystic; resonance cosmology; creative cycles of energy.
Ray Kurzweil,science,Modern,-0.4,0.9,0.2,2015,Singularity theorist; exponential progress; techno-teleology.
Donna Haraway,philosophy,Modern,-0.2,0.9,0.6,2015,Cyborg feminism; posthuman relational ontology; hybrid immanence.
Robin Wall Kimmerer,philosophy,Indigenous,0.6,0.8,0.9,2015,*Braiding Sweetgrass*; reciprocity with land; kinship ethics.
Suhrawardī (Illuminationist),philosophy,Islam,0.3,0.6,-0.5,1186,Philosophy of illumination; divine light as hierarchical continuum.
Ibn Taymiyyah,theology,Islam,-0.8,0.5,-0.8,1325,Literalist reformer; divine will absolute; anti-speculative transcendence.
Luisa Piccarreta,mysticism,Christian,-0.6,0.6,0.6,1910,Mystic of “Divine Will”; cyclical sanctification; participatory theosis.
`.trim();


function getValue(name){ const el=document.querySelector(`input[name="${name}"]:checked`); if(!el) return null; const v=parseInt(el.value,10); return (isNaN(v)||v<1||v>7)?null:v; }
function axisScore(axisKey){
  const cfg=AXES[axisKey]; const vals=[];
  for(const k of cfg.items){ const v=getValue(k); if(v==null) continue; vals.push(cfg.reverse.has(k)?(8-v):v); }
  if(!vals.length) return null;
  const mean=vals.reduce((a,b)=>a+b,0)/vals.length; return (mean-4)/3;
}
const fmt=x=>(x==null?'—':(Math.round(x*100)/100).toFixed(2));
function labelFor(axis,val){ if(val==null) return ''; if(axis==='T') return val>=0?'Cyclical/Rhythmic':'Linear/Teleological'; if(axis==='A') return val>=0?'Volitional/Participatory':'Deterministic/Constrained'; if(axis==='O') return val>=0?'Immanent/Relational':'Transcendent/Dualistic'; }
function typeOctant(t,a,o){ if([t,a,o].some(v=>v==null)) return 'Incomplete'; return `${t>=0?'Cyclical':'Linear'} • ${a>=0?'Volitional':'Deterministic'} • ${o>=0?'Immanent':'Transcendent'}`; }
function kvSummary(t,a,o){ if([t,a,o].some(v=>v==null)) return ''; return `T=${fmt(t)} · A=${fmt(a)} · O=${fmt(o)}`; }

/* 3D scene */
let renderer, scene, camera, controls, userPoint, refGroupTraditions, refGroupFigures, trendGroup,raycaster, mouse, tooltip;
function init3D(){
  const canvas=document.getElementById('plot3d');
  renderer=new THREE.WebGLRenderer({canvas, antialias:true});
  size3D();
  scene=new THREE.Scene();
  scene.background = (document.documentElement.dataset.theme==='light')?new THREE.Color(0xf6f6ff):new THREE.Color(0x0a0d18);
  camera=new THREE.PerspectiveCamera(50, canvas.clientWidth/canvas.clientHeight, .1, 100);
  camera.position.set(2.8,2.2,2.8);
  controls=new OrbitControls(camera, canvas); controls.enableDamping=true;

  scene.add(new THREE.AmbientLight(0x88aaff,.5));
  const dir=new THREE.DirectionalLight(0xffffff,.7); dir.position.set(2,3,4); scene.add(dir);

  // Axes
  const cT=0x6cc6ff, cA=0x6ee7a2, cO=0xffb86b;
  function axis(a,b,color){ const g=new THREE.BufferGeometry().setFromPoints([a,b]); scene.add(new THREE.Line(g,new THREE.LineBasicMaterial({color}))); }
  axis(new THREE.Vector3(-1,0,0), new THREE.Vector3(1,0,0), cT);
  axis(new THREE.Vector3(0,-1,0), new THREE.Vector3(0,1,0), cA);
  axis(new THREE.Vector3(0,0,-1), new THREE.Vector3(0,0,1), cO);

  // Add arrows at positive ends of axes
  const arrowLength = 0.15;
  const arrowHeadLength = 0.08;
  const arrowHeadWidth = 0.04;
  
  // T axis arrow (positive X direction)
  const tArrow = new THREE.ArrowHelper(
    new THREE.Vector3(1, 0, 0), // direction
    new THREE.Vector3(1 - arrowLength, 0, 0), // origin
    arrowLength, // length
    cT, // color
    arrowHeadLength,
    arrowHeadWidth
  );
  scene.add(tArrow);
  
  // A axis arrow (positive Y direction)
  const aArrow = new THREE.ArrowHelper(
    new THREE.Vector3(0, 1, 0), // direction
    new THREE.Vector3(0, 1 - arrowLength, 0), // origin
    arrowLength, // length
    cA, // color
    arrowHeadLength,
    arrowHeadWidth
  );
  scene.add(aArrow);
  
  // O axis arrow (positive Z direction)
  const oArrow = new THREE.ArrowHelper(
    new THREE.Vector3(0, 0, 1), // direction
    new THREE.Vector3(0, 0, 1 - arrowLength), // origin
    arrowLength, // length
    cO, // color
    arrowHeadLength,
    arrowHeadWidth
  );
  scene.add(oArrow);

  // Add axis labels
  function createAxisLabel(text, position, color) {
    const canvas = document.createElement('canvas');
    const context = canvas.getContext('2d');
    canvas.width = 64;
    canvas.height = 64;
    
    context.fillStyle = `#${color.toString(16).padStart(6, '0')}`;
    context.font = 'bold 48px Arial';
    context.textAlign = 'center';
    context.textBaseline = 'middle';
    context.fillText(text, 32, 32);
    
    const texture = new THREE.CanvasTexture(canvas);
    const spriteMaterial = new THREE.SpriteMaterial({ map: texture });
    const sprite = new THREE.Sprite(spriteMaterial);
    sprite.position.copy(position);
    sprite.scale.set(0.2, 0.2, 1);
    
    return sprite;
  }
  
  // Add labels at the tips of the arrows
  const tLabel = createAxisLabel('T', new THREE.Vector3(1.1, 0, 0), cT);
  const aLabel = createAxisLabel('A', new THREE.Vector3(0, 1.1, 0), cA);
  const oLabel = createAxisLabel('O', new THREE.Vector3(0, 0, 1.1), cO);
  
  scene.add(tLabel);
  scene.add(aLabel);
  scene.add(oLabel);

  // Bounds + origin
  scene.add(new THREE.Mesh(new THREE.BoxGeometry(2,2,2), new THREE.MeshBasicMaterial({color:0x334, wireframe:true, transparent:true, opacity:.25})));
  scene.add(new THREE.Mesh(new THREE.SphereGeometry(.03,24,16), new THREE.MeshStandardMaterial({color:0x8892ff, emissive:0x111133})));

  // User point
  userPoint=new THREE.Mesh(new THREE.SphereGeometry(.06,32,24), new THREE.MeshStandardMaterial({color:0xffffff, emissive:0x8899aa, metalness:.2, roughness:.35}));
  userPoint.visible=false; scene.add(userPoint);

  // Reference groups
  refGroupTraditions = new THREE.Group();
  refGroupFigures = new THREE.Group();
  trendGroup = new THREE.Group();
  scene.add(refGroupTraditions);
  scene.add(refGroupFigures);
  scene.add(trendGroup);

  // Groups are always visible; visibility is controlled by individual markers
  refGroupTraditions.visible = true;
  refGroupFigures.visible = true;

  // Picking
  raycaster=new THREE.Raycaster(); mouse=new THREE.Vector2();
  tooltip=document.getElementById('tooltip');
  canvas.addEventListener('click', onClickCanvas);
  window.addEventListener('resize', size3D);

  animate();
}
function size3D(){ const c=renderer?.domElement||document.getElementById('plot3d'); const w=c.clientWidth, h=520; if(renderer){ renderer.setSize(w,h,false); if(camera){ camera.aspect=w/h; camera.updateProjectionMatrix(); } } else { c.width=w; c.height=h; } }
function animate(){ requestAnimationFrame(animate); controls.update(); renderer.render(scene,camera); }
function clamp(x){ return Math.max(-1, Math.min(1, x)); }
function updateUserPoint(T,A,O){ if([T,A,O].some(v=>v==null)){ userPoint.visible=false; return; } userPoint.position.set(clamp(T), clamp(A), clamp(O)); userPoint.visible=true; }

async function loadTraditions(){
  const rows = parseCSV(CSV_TRADITIONS);
  plotReferences(rows, refGroupTraditions);
}

async function loadFigures(){
  const rows = parseCSV(CSV_FIGURES);
  plotReferences(rows, refGroupFigures);
}
function parseCSV(text){
  const lines = text.trim().split(/\r?\n/);
  const header = lines.shift().split(',');
  return lines.map(line => {
    const cols = line.split(',');
    const row = {}; header.forEach((h,i)=> row[h]=cols[i]);
    row.T = parseFloat(row.T); row.A = parseFloat(row.A); row.O = parseFloat(row.O);
    row.year = row.year !== undefined ? parseInt(row.year, 10) : NaN;
    return row;
  });
}

function lerp(a,b,t){ return a + (b - a) * t; }
function clamp01(x){ return Math.max(0, Math.min(1, x)); }

function colorRamp01(t){ // 0..1 -> blue → purple → orange
  const c1 = new THREE.Color(0x4ea7ff);
  const c2 = new THREE.Color(0x9d7ce8);
  const c3 = new THREE.Color(0xffb86b);
  if (t < 0.5) return c1.lerp(c2, t*2);
  return c2.lerp(c3, (t-0.5)*2);
}

function scalarToColor(x, min, max){
  const t = clamp01((x - min) / (max - min));
  return colorRamp01(t);
}

function axisColor(axisVal){ // axisVal in [-1,1]
  return scalarToColor(axisVal, -1, 1);
}

function timeColor(year, minYear, maxYear){
  return scalarToColor(year, minYear, maxYear);
}

function getCategoryKey(cat){
  if(!cat) return null;
  const c = cat.toLowerCase();
  if (c==='religion') return 'religion';
  if (c==='philosophy') return 'philosophy';
  if (c==='mysticism') return 'mysticism';
  if (c==='modern') return 'modern';
  if (c==='politics'||c==='leaders') return 'politics';
  if (c==='science'||c==='other') return 'science';
  return null;
}

function categoryColor(cat){
  if(!cat) return new THREE.Color(0xffffff);
  const c = cat.toLowerCase();
  if (c==='religion')   return new THREE.Color(0x6cc6ff);
  if (c==='philosophy') return new THREE.Color(0x6ee7a2);
  if (c==='mysticism')  return new THREE.Color(0xffb86b);
  if (c==='modern')     return new THREE.Color(0xff7b7b);
  if (c==='politics'||c==='leaders') return new THREE.Color(0xc792ea);
  if (c==='science'||c==='other')    return new THREE.Color(0xf2cc60);
  return new THREE.Color(0xffffff);
}

function plotIntoGroup(rows, targetGroup){
  // clear
  for (let i = targetGroup.children.length - 1; i >= 0; i--) {
    targetGroup.remove(targetGroup.children[i]);
  }
  rows.forEach(r => {
    if (isNaN(r.T) || isNaN(r.A) || isNaN(r.O)) return;
    const mat = new THREE.MeshStandardMaterial({
      color: categoryColor(r.category),
      emissive: 0x111111, roughness: .5, metalness: .1
    });
    const m = new THREE.Mesh(new THREE.SphereGeometry(.04, 20, 16), mat);
    m.position.set(clamp(r.T), clamp(r.A), clamp(r.O));
    m.userData = r;
    targetGroup.add(m);
  });
}

function plotReferences(rows, targetGroup){ plotIntoGroup(rows, targetGroup); }

/* Tooltip via raycast */
function onClickCanvas(ev){
  const rect = renderer.domElement.getBoundingClientRect();
  mouse.x = ((ev.clientX - rect.left) / rect.width) * 2 - 1;
  mouse.y = -((ev.clientY - rect.top) / rect.height) * 2 + 1;
  raycaster.setFromCamera(mouse, camera);

  let candidates = [];
  // Include all children from both groups, but filter by visibility
  candidates = candidates.concat(refGroupTraditions.children.filter(m => m.visible));
  candidates = candidates.concat(refGroupFigures.children.filter(m => m.visible));

  if (!candidates.length) { hideTooltip(); return; }

  const hits = raycaster.intersectObjects(candidates, false);
  if (hits.length){
    const hit = hits[0].object.userData;
    showTooltip(ev.clientX, ev.clientY,
      `${hit.name}<br/>T=${(+hit.T).toFixed(2)} · A=${(+hit.A).toFixed(2)} · O=${(+hit.O).toFixed(2)}<br/>` +
      `<span style="opacity:.8">${hit.category}</span><br/><span style="opacity:.7">${hit.notes||''}</span>`
    );
  } else {
    hideTooltip();
  }
}
function showTooltip(x,y,html){
  tooltip.style.display='block';
  tooltip.style.left = x + 'px';
  tooltip.style.top  = y + 'px';
  tooltip.innerHTML = html;
}
function hideTooltip(){ tooltip.style.display='none'; }

/* Theme & actions */
function setTheme(mode){ document.documentElement.setAttribute('data-theme', mode); localStorage.setItem('tao_theme', mode); if(scene) scene.background=(mode==='light')?new THREE.Color(0xf6f6ff):new THREE.Color(0x0a0d18); }
document.getElementById('themeBtn').addEventListener('click', ()=> setTheme((document.documentElement.getAttribute('data-theme')||'dark')==='dark'?'light':'dark'));

function compute(){
  const T=axisScore('T'), A=axisScore('A'), O=axisScore('O');
  document.getElementById('Tscore').textContent=fmt(T);
  document.getElementById('Ascore').textContent=fmt(A);
  document.getElementById('Oscore').textContent=fmt(O);
  document.getElementById('Tlabel').textContent=labelFor('T',T)||'';
  document.getElementById('Alabel').textContent=labelFor('A',A)||'';
  document.getElementById('Olabel').textContent=labelFor('O',O)||'';
  document.getElementById('typeLabel').textContent=typeOctant(T,A,O);
  document.getElementById('kvs').textContent=kvSummary(T,A,O);
  updateUserPoint(T,A,O);
}
function clearAll(){
  document.querySelectorAll('input[type="radio"]:checked').forEach(el=>el.checked=false);
  ['Tscore','Ascore','Oscore','Tlabel','Alabel','Olabel','typeLabel','kvs'].forEach(id=>document.getElementById(id).textContent='—');
  updateUserPoint(null,null,null); hideTooltip(); controls.reset(); camera.position.set(2.8,2.2,2.8);
}
function saveJSON(){
  const data={}; document.querySelectorAll('.scale').forEach(sc=>{const key=sc.dataset.key; const el=document.querySelector(`input[name="${key}"]:checked`); if(el) data[key]=parseInt(el.value,10);});
  const blob=new Blob([JSON.stringify({timestamp:new Date().toISOString(), answers:data},null,2)],{type:'application/json'});
  const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='tao_r3_answers.json'; a.click(); URL.revokeObjectURL(a.href);
}
function exportCSV(){
  const T=axisScore('T'),A=axisScore('A'),O=axisScore('O');
  const csv='T_score,A_score,O_score,type\n'+[T,A,O,typeOctant(T,A,O)].join(',')+'\n';
  const blob=new Blob([csv],{type:'text/csv'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='tao_r3_scores.csv'; a.click(); URL.revokeObjectURL(a.href);
}

let allRows = []; // union of visible datasets
let allTraditions = new Set();
let subtypesByTradition = new Map();
let currentTradition = '__all__';
let currentSubtype = '__all__';
let currentDataSource = 'both';
let visibleCategories = new Set(['religion', 'philosophy', 'mysticism', 'modern', 'politics', 'science']);
let yearMin =  -10000, yearMax = 2025;

function gatherAllRows(){
  allRows = [];
  if (refGroupTraditions?.children?.length){
    refGroupTraditions.children.forEach(m=> allRows.push(m.userData));
  }
  if (refGroupFigures?.children?.length){
    refGroupFigures.children.forEach(m=> allRows.push(m.userData));
  }

  const ys = allRows.map(r => r.year).filter(y => !Number.isNaN(y));
  if (ys.length){ yearMin = Math.min(...ys); yearMax = Math.max(...ys); }

  // Build tradition/subtype index
  allTraditions = new Set();
  subtypesByTradition = new Map();

  allRows.forEach(r => {
    const trad = (r.tradition || '').trim();
    if (!trad) return;
    allTraditions.add(trad);
    const sub = (r.subtype || '').trim();
    if (!subtypesByTradition.has(trad)) subtypesByTradition.set(trad, new Set());
    if (sub) subtypesByTradition.get(trad).add(sub);
  });

  populateTraditionSelect();
}

function applyColors(){
  const mode = document.getElementById('colorMode')?.value || 'category';
  const yrCut = parseInt(document.getElementById('yearRange')?.value||yearMax,10);

  const recolorGroup = (group, groupType) => {
    if (!group) return;
    group.children.forEach(m => {
      const r = m.userData;
      const alive = Number.isNaN(r.year) || r.year <= yrCut;

      // Data source filter
      let passesDataSource = true;
      if (currentDataSource === 'traditions' && groupType !== 'traditions') {
        passesDataSource = false;
      } else if (currentDataSource === 'figures' && groupType !== 'figures') {
        passesDataSource = false;
      }

      // Category visibility filter
      const categoryKey = getCategoryKey(r.category);
      const passesCategory = !categoryKey || visibleCategories.has(categoryKey);

      // tradition/subtype filter
      let passesTrad = true;
      if (currentTradition !== '__all__') {
        passesTrad = (r.tradition && r.tradition === currentTradition);
      }
      let passesSubtype = true;
      if (passesTrad && currentSubtype !== '__all__') {
        // Only traditions dataset has subtype; figures may not. Treat missing as non-match.
        passesSubtype = (r.subtype && r.subtype === currentSubtype);
      }

      m.visible = alive && passesDataSource && passesCategory && passesTrad && passesSubtype;

      let col;
      if (mode==='category') col = categoryColor(r.category);
      else if (mode==='time' && !Number.isNaN(r.year)) col = timeColor(r.year, yearMin, yearMax);
      else if (mode==='T') col = axisColor(r.T);
      else if (mode==='A') col = axisColor(r.A);
      else if (mode==='O') col = axisColor(r.O);
      else col = categoryColor(r.category);

      m.material.color.copy(col);
    });
  };

  recolorGroup(refGroupTraditions, 'traditions');
  recolorGroup(refGroupFigures, 'figures');
  updateTrends();
}

function visibleMarkersFrom(group){
  return (group?.children || []).filter(m => m.visible);
}

// Robust median (ignores NaN)
function median(arr){
  const a = arr.filter(x => Number.isFinite(x)).sort((x,y)=>x-y);
  if (!a.length) return NaN;
  const mid = Math.floor(a.length/2);
  return a.length % 2 ? a[mid] : (a[mid-1]+a[mid])/2;
}

function buildBinMedians(markers, axisKey='O', bins=8, minPerBin=3){
  if (!markers.length) return [];
  // choose param axis
  const getAxisVal = (m, key) => (key==='T'?m.userData.T:(key==='A'?m.userData.A:m.userData.O));
  const minV=-1, maxV=1, step=(maxV-minV)/bins;
  const binsArr = Array.from({length: bins}, () => []);

  markers.forEach(m => {
    const t = getAxisVal(m, axisKey);
    if (!Number.isFinite(t)) return;
    let idx = Math.floor((t-minV)/step);
    if (idx<0) idx=0; if (idx>=bins) idx=bins-1;
    binsArr[idx].push(m);
  });

  // For each bin: median of the *other two* axes + bin-center on axisKey
  const centers = [];
  binsArr.forEach((bucket, i) => {
    if (bucket.length < minPerBin) return;
    const valsT = bucket.map(m => m.userData.T);
    const valsA = bucket.map(m => m.userData.A);
    const valsO = bucket.map(m => m.userData.O);

    const centerVal = minV + (i+0.5)*step;
    let Tm = median(valsT), Am = median(valsA), Om = median(valsO);

    // Force the param axis to the bin center to create a monotone trace
    if (axisKey==='T') Tm = centerVal;
    if (axisKey==='A') Am = centerVal;
    if (axisKey==='O') Om = centerVal;

    if ([Tm,Am,Om].every(Number.isFinite)){
      centers.push(new THREE.Vector3(Tm, Am, Om));
    }
  });

  // Need at least 4 points for a nice curve
  return centers.length >= 4 ? centers : [];
}

function curveToTube(curvePoints, colorStart=0x4ea7ff, colorEnd=0xffb86b){
  const curve = new THREE.CatmullRomCurve3(curvePoints, false, 'centripetal'); // avoids loops
  const tubularSegments = 200;
  const radius = 0.02; // skinny ribbon/tube
  const radialSegments = 8;
  const closed = false;

  const geom = new THREE.TubeGeometry(curve, tubularSegments, radius, radialSegments, closed);

  // Vertex color gradient along length (s parameter 0..1)
  const pos = geom.attributes.position;
  const colors = new Float32Array(pos.count * 3);
  const c1 = new THREE.Color(colorStart);
  const c2 = new THREE.Color(colorEnd);
  for (let i=0;i<pos.count;i++){
    const u = (i / (pos.count-1));
    const c = c1.clone().lerp(c2, u);
    colors[i*3+0] = c.r;
    colors[i*3+1] = c.g;
    colors[i*3+2] = c.b;
  }
  geom.setAttribute('color', new THREE.BufferAttribute(colors, 3));

  const mat = new THREE.MeshBasicMaterial({
    vertexColors: true,
    transparent: true,
    opacity: 0.55,
    depthWrite: false
  });

  const mesh = new THREE.Mesh(geom, mat);
  mesh.renderOrder = 1; // slightly on top of points
  return mesh;
}

function clearTrends(){
  for (let i = trendGroup.children.length - 1; i >= 0; i--){
    trendGroup.remove(trendGroup.children[i]);
  }
}

function updateTrends(){
  const toggle = document.getElementById('trendToggle');
  if (!toggle || !toggle.checked){ clearTrends(); return; }

  const axis = (document.getElementById('trendAxis')?.value) || 'O';

  clearTrends();

  const sets = [];
  if (currentDataSource==='both' || currentDataSource==='traditions') sets.push({group: refGroupTraditions, color1:0x6cc6ff, color2:0x6ee7a2});
  if (currentDataSource==='both' || currentDataSource==='figures')    sets.push({group: refGroupFigures,    color1:0xc792ea, color2:0xffb86b});

  sets.forEach(s => {
    const vis = visibleMarkersFrom(s.group);
    const centers = buildBinMedians(vis, axis, /*bins*/ 10, /*minPerBin*/ 3);
    if (centers.length >= 4){
      const mesh = curveToTube(centers, s.color1, s.color2);
      trendGroup.add(mesh);
    }
    // If we didn't get enough centers, we intentionally draw nothing.
  });
}

function populateTraditionSelect(){
  const sel = document.getElementById('traditionFilter');
  if (!sel) return;
  // reset options
  sel.innerHTML = '<option value="__all__">All</option>';
  Array.from(allTraditions).sort().forEach(trad => {
    const opt = document.createElement('option');
    opt.value = trad; opt.textContent = trad;
    sel.appendChild(opt);
  });
  // when tradition changes, rebuild subtype list
  sel.addEventListener('change', () => {
    currentTradition = sel.value;
    populateSubtypeSelect(currentTradition);
    applyColors(); // re-run visibility & ribbons
  });

  // initial
  currentTradition = '__all__';
  populateSubtypeSelect(currentTradition);
}

function populateSubtypeSelect(trad){
  const sel = document.getElementById('subtypeFilter');
  if (!sel) return;
  sel.innerHTML = '<option value="__all__">All</option>';

  const set = subtypesByTradition.get(trad);
  if (trad !== '__all__' && set && set.size){
    Array.from(set).sort().forEach(st => {
      const opt = document.createElement('option');
      opt.value = st; opt.textContent = st;
      sel.appendChild(opt);
    });
    sel.disabled = false;
  } else {
    // If tradition is "All" or there are no subtypes, disable
    sel.disabled = true;
  }

  sel.value = '__all__';
  currentSubtype = '__all__';

  sel.onchange = () => {
    currentSubtype = sel.value;
    applyColors();
  };
}

function wireGradientUI(){
  const colorMode   = document.getElementById('colorMode');
  const dataSource  = document.getElementById('dataSource');
  const yearRange   = document.getElementById('yearRange');
  const yearLabel   = document.getElementById('yearLabel');

  const updateYearLabel = () => { yearLabel.textContent = `≤ ${yearRange.value}`; };

  if (colorMode){
    colorMode.addEventListener('change', applyColors);
  }
  if (dataSource){
    dataSource.addEventListener('change', () => {
      currentDataSource = dataSource.value;
      applyColors();
    });
  }
  if (yearRange){
    yearRange.addEventListener('input', ()=>{ updateYearLabel(); applyColors(); });
    updateYearLabel();
  }
}

function wireTrendUI(){
  const trendToggle = document.getElementById('trendToggle');
  const trendAxis   = document.getElementById('trendAxis');
  const update = () => { updateTrends(); };
  [trendToggle, trendAxis].forEach(el => el && el.addEventListener('change', update));
}

function toggleCategoryVisibility(category) {
  if (visibleCategories.has(category)) {
    visibleCategories.delete(category);
  } else {
    visibleCategories.add(category);
  }
  
  // Update legend visual state
  const legendRow = document.querySelector(`[data-category="${category}"]`);
  if (legendRow) {
    legendRow.classList.toggle('hidden', !visibleCategories.has(category));
  }
  
  // Update point visibility
  applyColors();
}

function wireLegendUI(){
  document.querySelectorAll('.legend-row').forEach(row => {
    row.addEventListener('click', () => {
      const category = row.dataset.category;
      if (category) {
        toggleCategoryVisibility(category);
      }
    });
  });
}

function parseQueryParams(){
  const params = new URLSearchParams(window.location.search);
  const t = params.get('t');
  const a = params.get('a');
  const o = params.get('o');
  
  // Parse and validate values (should be between -1 and 1)
  const parseValue = (val) => {
    if (!val) return null;
    const num = parseFloat(val);
    if (isNaN(num)) return null;
    return Math.max(-1, Math.min(1, num)); // clamp to [-1, 1]
  };
  
  return {
    T: parseValue(t),
    A: parseValue(a),
    O: parseValue(o)
  };
}

function updateResultsFromValues(T, A, O){
  document.getElementById('Tscore').textContent = fmt(T);
  document.getElementById('Ascore').textContent = fmt(A);
  document.getElementById('Oscore').textContent = fmt(O);
  document.getElementById('Tlabel').textContent = labelFor('T', T) || '';
  document.getElementById('Alabel').textContent = labelFor('A', A) || '';
  document.getElementById('Olabel').textContent = labelFor('O', O) || '';
  document.getElementById('typeLabel').textContent = typeOctant(T, A, O);
  document.getElementById('kvs').textContent = kvSummary(T, A, O);
  updateUserPoint(T, A, O);
}

function addEventListeners(){
  document.getElementById('computeBtn').addEventListener('click', compute);
  document.getElementById('clearBtn').addEventListener('click', clearAll);
  document.getElementById('saveBtn').addEventListener('click', saveJSON);
  document.getElementById('csvBtn').addEventListener('click', exportCSV);
  document.getElementById('shareBtn').addEventListener('click', ()=>{ /* optional future: encode answers in URL */ alert('Share coming soon.'); });
  document.getElementById('printBtn').addEventListener('click', ()=>window.print());
}

/* Init */
(function init(){
  setTheme(localStorage.getItem('tao_theme')||'dark');
  init3D();
  loadTraditions();
  loadFigures();
  gatherAllRows();
  wireGradientUI();
  wireTrendUI();
  wireLegendUI();
  applyColors();
  addEventListeners();
  
  // Check for query parameters and apply them
  const queryValues = parseQueryParams();
  if (queryValues.T !== null || queryValues.A !== null || queryValues.O !== null) {
    updateResultsFromValues(queryValues.T, queryValues.A, queryValues.O);
  }
})();
</script>
</body>
</html>
